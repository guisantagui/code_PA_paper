theme(axis.text.x = element_text(angle = 90)) +
#coord_flip() +
labs(
y= "Silhouete",
x= "Method"
)
ggplot(data = silhvar, mapping = aes(x = method, y = silh)) +
geom_boxplot() +
geom_point(data=normreport,mapping=aes(x=method,y=silh)) +
geom_line() +
theme(axis.text.x = element_text(angle = 90)) +
#coord_flip() +
labs(
y= "Silhouete",
x= "Method"
)
ggplot(data = silhvar, mapping = aes(x = method, y = silh)) +
geom_boxplot() +
geom_point(data=normreport,mapping=aes(x=method,y=silh),linetype="dashed") +
theme(axis.text.x = element_text(angle = 90)) +
#coord_flip() +
labs(
y= "Silhouete",
x= "Method"
)
ggplot(data = silhvar, mapping = aes(x = method, y = silh)) +
geom_boxplot() +
geom_line(data=normreport,mapping=aes(x=method,y=silh,group=1)) +
theme(axis.text.x = element_text(angle = 90)) +
#coord_flip() +
labs(
y= "Silhouete",
x= "Method"
)
ggplot(data = silhvar, mapping = aes(x = reorder(method, silh, FUN=median), y = silh)) +
geom_boxplot() +
#geom_line(data=normreport,mapping=aes(x=method,y=silh,group=1)) +
theme(axis.text.x = element_text(angle = 90)) +
#coord_flip() +
labs(
y= "Silhouete",
x= "Method"
)
ggplot(data = silhvar, mapping = aes(x = reorder(method, silh, FUN=mean), y = silh)) +
geom_boxplot() +
#geom_line(data=normreport,mapping=aes(x=method,y=silh,group=1)) +
theme(axis.text.x = element_text(angle = 90)) +
#coord_flip() +
labs(
y= "Silhouete",
x= "Method"
)
ggplot(data = silhvar, mapping = aes(x = reorder(method, silh, FUN=median), y = silh)) +
geom_boxplot() +
#geom_line(data=normreport,mapping=aes(x=method,y=silh,group=1)) +
theme(axis.text.x = element_text(angle = 90)) +
#coord_flip() +
labs(
y= "Silhouete",
x= "Method"
)
ggplot(data = silhvar, mapping = aes(x = reorder(method, silh, FUN=mean), y = silh)) +
geom_boxplot() +
#geom_line(data=normreport,mapping=aes(x=method,y=silh,group=1)) +
theme(axis.text.x = element_text(angle = 90)) +
#coord_flip() +
labs(
y= "Silhouete",
x= "Method"
)
ggsave("normmethod_silh.pdf")
normreport=data.frame(method=normmethod, silh=rep(0,7), score=rep(0,7), rscore=rep(0,7),difmet=rep(0,7), stringsAsFactors = F)
normreport[1,2]=mean(neibprenorm$silh)
normreport[1,3]=mean(neibprenorm$score)
normreport[1,4]=mean(neibprenorm$rscore)
normreport[1,5]=sum(metvarprenorm$metvar$padj<0.01)
normreport[2,2]=mean(neibmed$silh)
normreport[2,3]=mean(neibmed$score)
normreport[2,4]=mean(neibmed$rscore)
normreport[2,5]=sum(metvarmed$metvar$padj<0.01)
normreport[3,2]=mean(neibmean$silh)
normreport[3,3]=mean(neibmean$score)
normreport[3,4]=mean(neibmean$rscore)
normreport[3,5]=sum(metvarmean$metvar$padj<0.01)
normreport[4,2]=mean(neibsum$silh)
normreport[4,3]=mean(neibsum$score)
normreport[4,4]=mean(neibsum$rscore)
normreport[4,5]=sum(metvarsum$metvar$padj<0.01)
normreport[5,2]=mean(neibccmn$silh)
normreport[5,3]=mean(neibccmn$score)
normreport[5,4]=mean(neibccmn$rscore)
normreport[5,5]=sum(metvarccmn$metvar$padj<0.01)
normreport[6,2]=mean(neibnomis$silh)
normreport[6,3]=mean(neibnomis$score)
normreport[6,4]=mean(neibnomis$rscore)
normreport[6,5]=sum(metvarnomis$metvar$padj<0.01)
normreport[7,2]=mean(neibis$silh)
normreport[7,3]=mean(neibis$score)
normreport[7,4]=mean(neibis$rscore)
normreport[7,5]=sum(metvaris$metvar$padj<0.01)
normreport
ggplot(data = silhvar, mapping = aes(x = reorder(method, silh, FUN=median), y = silh)) +
geom_boxplot() +
#geom_line(data=normreport,mapping=aes(x=method,y=silh,group=1)) +
theme(axis.text.x = element_text(angle = 90)) +
#coord_flip() +
labs(
y= "Silhouete",
x= "Method"
)
gclass=c(1,1,1,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7,8,8,8,9,9,9,10,10,10,11,11,11,12,12,12,13,13,13,14,14,14,15,15,15,16,16,16,17,17,17,18,18,18,19,19,19,20,20,20,21,21,21,22,22,22,23,23,23,24,24,24,25,25,25,26,26,26,27,27,27)
mgclass=matrix(gclass,nrows=1)
mgclass=matrix(gclass,nrow=1)
mgmat1=repmat(mgclass,84,1)
mgclass=matrix(rep(gclass,84),nrow=84,ncol=84)
tmgclass=t(mgclass)
View(mgclass)
View(tmgclass)
View(tmgclass)
neibcheck=function(valuemat){
gclass=c(1,1,1,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7,8,8,8,9,9,9,10,10,10,11,11,11,12,12,12,13,13,13,14,14,14,15,15,15,16,16,16,17,17,17,18,18,18,19,19,19,20,20,20,21,21,21,22,22,22,23,23,23,24,24,24,25,25,25,26,26,26,27,27,27)
straindist=as.matrix(dist(valuemat, method="euclidean"))
score=rep(0,28)
rscore=rep(0,28)
silh=silhouette(gclass,dmatrix=straindist)
mgclass=matrix(rep(gclass,84),nrow=84,ncol=84)
tmgclass=t(mgclass)
diffclass=(mgclass!=tmgclass)
sameclassdist=mean(straindist[!diffclass])
difclassdist=mean(straindist[difclass])
for (i in 1:28){
subdist=straindist[(1+3*(i-1)):(3*i),]
points=0
rpoints=0
for (j in 1:3){
rankvec=rank(subdist[j,])
dvec=subdist[j,]
mvec=dvec
mvec[dvec==0]=max(dvec)
dvec[dvec==0]=min(mvec)
dvec=(dvec-min(mvec))/(max(dvec)-min(mvec))
points=points+sum(rankvec[(1+3*(i-1)):(3*i)])-6
rpoints=rpoints+sum(dvec[(1+3*(i-1)):(3*i)])
}
score[i]=points
rscore[i]=rpoints
}
score=score/3
rscore=rscore/6
list(score=score,rscore=rscore,silh=silh[,3],sdist=sameclassdist,ddist=difclassdist)
}
neibprenorm=neibcheck(log.data[,2:97])
neibcheck=function(valuemat){
gclass=c(1,1,1,1,1,1,2,2,2,3,3,3,4,4,4,5,5,5,6,6,6,7,7,7,8,8,8,9,9,9,10,10,10,11,11,11,12,12,12,13,13,13,14,14,14,15,15,15,16,16,16,17,17,17,18,18,18,19,19,19,20,20,20,21,21,21,22,22,22,23,23,23,24,24,24,25,25,25,26,26,26,27,27,27)
straindist=as.matrix(dist(valuemat, method="euclidean"))
score=rep(0,28)
rscore=rep(0,28)
silh=silhouette(gclass,dmatrix=straindist)
mgclass=matrix(rep(gclass,84),nrow=84,ncol=84)
tmgclass=t(mgclass)
diffclass=(mgclass!=tmgclass)
sameclassdist=mean(straindist[!diffclass])
difclassdist=mean(straindist[diffclass])
for (i in 1:28){
subdist=straindist[(1+3*(i-1)):(3*i),]
points=0
rpoints=0
for (j in 1:3){
rankvec=rank(subdist[j,])
dvec=subdist[j,]
mvec=dvec
mvec[dvec==0]=max(dvec)
dvec[dvec==0]=min(mvec)
dvec=(dvec-min(mvec))/(max(dvec)-min(mvec))
points=points+sum(rankvec[(1+3*(i-1)):(3*i)])-6
rpoints=rpoints+sum(dvec[(1+3*(i-1)):(3*i)])
}
score[i]=points
rscore[i]=rpoints
}
score=score/3
rscore=rscore/6
list(score=score,rscore=rscore,silh=silh[,3],sdist=sameclassdist,ddist=difclassdist)
}
neibprenorm=neibcheck(log.data[,2:97])
neibmed=neibcheck(norm_med[,2:97])
neibmean=neibcheck(norm_mean[,2:97])
neibsum=neibcheck(norm_sum[,2:97])
neibccmn=neibcheck(norm_ccmn[,2:91])
neibnomis=neibcheck(norm_nomis[,2:91])
neibis=neibcheck(norm_is[,2:97])
normreport=data.frame(method=normmethod, silh=rep(0,7), score=rep(0,7), rscore=rep(0,7),difmet=rep(0,7),sd=rep(0,7),dd=rep(0,7), stringsAsFactors = F)
normreport[1,2]=mean(neibprenorm$silh)
normreport[1,3]=mean(neibprenorm$score)
normreport[1,4]=mean(neibprenorm$rscore)
normreport[1,5]=sum(metvarprenorm$metvar$padj<0.01)
normreport[1,6]=neibprenorm$sdist
normreport[1,7]=neibprenorm$ddist
normreport[2,2]=mean(neibmed$silh)
normreport[2,3]=mean(neibmed$score)
normreport[2,4]=mean(neibmed$rscore)
normreport[2,5]=sum(metvarmed$metvar$padj<0.01)
normreport[2,6]=neibmed$sdist
normreport[2,7]=neibmed$ddist
normreport[3,2]=mean(neibmean$silh)
normreport[3,3]=mean(neibmean$score)
normreport[3,4]=mean(neibmean$rscore)
normreport[3,5]=sum(metvarmean$metvar$padj<0.01)
normreport[3,6]=neibmean$sdist
normreport[3,7]=neibmean$ddist
normreport[4,2]=mean(neibsum$silh)
normreport[4,3]=mean(neibsum$score)
normreport[4,4]=mean(neibsum$rscore)
normreport[4,5]=sum(metvarsum$metvar$padj<0.01)
normreport[4,6]=neibsum$sdist
normreport[4,7]=neibsum$ddist
normreport[5,2]=mean(neibccmn$silh)
normreport[5,3]=mean(neibccmn$score)
normreport[5,4]=mean(neibccmn$rscore)
normreport[5,5]=sum(metvarccmn$metvar$padj<0.01)
normreport[5,6]=neibccmn$sdist
normreport[5,7]=neibccmn$ddist
normreport[6,2]=mean(neibnomis$silh)
normreport[6,3]=mean(neibnomis$score)
normreport[6,4]=mean(neibnomis$rscore)
normreport[6,5]=sum(metvarnomis$metvar$padj<0.01)
normreport[6,6]=neibnomis$sdist
normreport[6,7]=neibnomis$ddist
normreport[7,2]=mean(neibis$silh)
normreport[7,3]=mean(neibis$score)
normreport[7,4]=mean(neibis$rscore)
normreport[7,5]=sum(metvaris$metvar$padj<0.01)
normreport[7,6]=neibis$sdist
normreport[7,7]=neibis$ddist
normreport
ggplot(data = normreport, mapping = aes(x = sd, y = dd)) +
geom_point() +
geom_text(aes(labels=method))
ggplot(data = normreport, mapping = aes(x = sd, y = dd)) +
geom_point() +
geom_text(aes(label=method))
ggplot(data = normreport, mapping = aes(x = sd, y = dd)) +
geom_point() +
#geom_text(aes(label=method))
labs(
y= "mean distance between replicates",
x= "mean distance between strains"
)
fnormreport=normreport[c(1,2,3,5,6,7),]
ggplot(data = fnormreport, mapping = aes(x = sd, y = dd)) +
geom_point() +
#geom_text(aes(label=method))
labs(
y= "mean distance between replicates",
x= "mean distance between strains"
)
ggplot(data = fnormreport, mapping = aes(x = sd, y = dd)) +
geom_point() +
geom_text(aes(label=method))
fnormreport=normreport[c(1,2,3,5,6),]
ggplot(data = fnormreport, mapping = aes(x = sd, y = dd)) +
geom_point() +
geom_text(aes(label=method)) +
labs(
y= "mean distance between replicates",
x= "mean distance between strains"
)
fnormreport=normreport[c(1,2,3,5,6),]
ggplot(data = fnormreport, mapping = aes(x = sd, y = dd)) +
geom_point() +
geom_text(aes(label=method)) +
labs(
y= "mean distance between strains",
x= "mean distance between replicates"
)
ggplot(data = fnormreport, mapping = aes(x = sd, y = dd)) +
geom_point() +
geom_label(aes(label=method, nudge_y=0.1)) +
labs(
y= "mean distance between strains",
x= "mean distance between replicates"
)
ggplot(data = fnormreport, mapping = aes(x = sd, y = dd)) +
geom_point() +
geom_label(aes(label=method, nudge_y=1)) +
labs(
y= "mean distance between strains",
x= "mean distance between replicates"
)
ggplot(data = fnormreport, mapping = aes(x = sd, y = dd)) +
geom_point() +
geom_label(aes(label=method),nudge_y=1) +
labs(
y= "mean distance between strains",
x= "mean distance between replicates"
)
ggplot(data = fnormreport, mapping = aes(x = sd, y = dd)) +
geom_point() +
geom_label(aes(label=method),nudge_y=0.1) +
labs(
y= "mean distance between strains",
x= "mean distance between replicates"
)
ggplot(data = fnormreport, mapping = aes(x = sd, y = dd)) +
geom_point() +
geom_label(aes(label=method),nudge_y=0.05) +
labs(
y= "mean distance between strains",
x= "mean distance between replicates"
)
ggplot(data = fnormreport, mapping = aes(x = sd, y = dd)) +
geom_point() +
geom_label(aes(label=method),nudge_y=0.03) +
labs(
y= "mean distance between strains",
x= "mean distance between replicates"
)
ggplot(data = fnormreport, mapping = aes(x = sd, y = dd)) +
geom_point() +
geom_label(aes(label=method),nudge_y=0.025) +
labs(
y= "mean distance between strains",
x= "mean distance between replicates"
)
ggsave("normmethod_dist.pdf")
ggplot(data = fnormreport, mapping = aes(x = sd, y = dd)) +
geom_point() +
geom_label(aes(label=method),nudge_y=0.025) +
labs(
y= "Mean distance between strains",
x= "Mean distance between replicates"
)
ggsave("normmethod_dist.pdf")
metnames2=colnames(norm_ccmn[,2:91])
samplename2=row.names(norm_ccmn)
ccmndatatable=data.frame(sample=rep('.',84*91),strain=rep('.',84*91),metabolite=rep('.',84*91),peak=rep(0,84*91),significant=rep(0,84*91),stringsAsFactors = F)
line=0
for (i in 1:84){
for (j in 2:97){
line=line+1
ccmndatatable[line,1]=samplename2[i]
ccmndatatable[line,2]=as.character(norm_ccmn[i,1])
ccmndatatable[line,3]=metnames2[j-1]
ccmndatatable[line,4]=norm_ccmn[i,j]
if (metvarccmn$metvar$padj[metvarccmn$metvar$names==metnames2[j-1]]<0.05){
ccmndatatable[line,5]=1
}
}
}
metnames2=colnames(norm_ccmn[,2:91])
samplename2=row.names(norm_ccmn)
ccmndatatable=data.frame(sample=rep('.',84*91),strain=rep('.',84*91),metabolite=rep('.',84*91),peak=rep(0,84*91),significant=rep(0,84*91),stringsAsFactors = F)
line=0
for (i in 1:84){
for (j in 2:91){
line=line+1
ccmndatatable[line,1]=samplename2[i]
ccmndatatable[line,2]=as.character(norm_ccmn[i,1])
ccmndatatable[line,3]=metnames2[j-1]
ccmndatatable[line,4]=norm_ccmn[i,j]
if (metvarccmn$metvar$padj[metvarccmn$metvar$names==metnames2[j-1]]<0.05){
ccmndatatable[line,5]=1
}
}
}
ggplot(data = ccmndatatable, mapping = aes(x = sample, y = peak)) +
geom_boxplot() +
theme(axis.text.x = element_text(angle = 90)) +
#coord_flip() +
labs(
y= "Abundance",
x= "Sample"
)
ggsave("sample_boxplot_ccmn.pdf",width = 9, height = 5)
ggplot(data = ccmndatatable, mapping = aes(x = reorder(metabolite, peak, FUN=median), y = peak, color=significant)) +
geom_boxplot() +
coord_flip() +
labs(
y= "Abundance",
x= "Metabolite"
)
ggsave("metabolite_boxplot_ccmn.pdf",width = 7, height = 11)
aa=metvarccmn$metvar
View(aa)
ncset2=which(is.element(metnames,nonvarmet))
norm_ccmn2 <- Normalise(log.data,method="ccmn",nc=ncset2)$output
nonvarmet=metnames[metvarprenorm$metvar$padj>0.05]
ncset2=which(is.element(metnames,nonvarmet))
nonvarmet=nonvarmet[c(1,4,5,6,7,8)]
ncset=which(is.element(metnames,nonvarmet))
norm_ccmn2 <- Normalise(log.data,method="ccmn",nc=ncset2)$output
metvarccmn=metvar(norm_ccmn[,2:87],log.data[,1])
neibccmn=neibcheck(norm_ccmn[,2:87])
normmethod=c("pre","median","mean","sum","ccmn","nomis","is","ccmn2")
normreport=data.frame(method=normmethod, silh=rep(0,8), score=rep(0,8), rscore=rep(0,8),difmet=rep(0,8),sd=rep(0,8),dd=rep(0,8), stringsAsFactors = F)
normreport[1,2]=mean(neibprenorm$silh)
normreport[1,3]=mean(neibprenorm$score)
normreport[1,4]=mean(neibprenorm$rscore)
normreport[1,5]=sum(metvarprenorm$metvar$padj<0.01)
normreport[1,6]=neibprenorm$sdist
normreport[1,7]=neibprenorm$ddist
normreport[2,2]=mean(neibmed$silh)
normreport[2,3]=mean(neibmed$score)
normreport[2,4]=mean(neibmed$rscore)
normreport[2,5]=sum(metvarmed$metvar$padj<0.01)
normreport[2,6]=neibmed$sdist
normreport[2,7]=neibmed$ddist
normreport[3,2]=mean(neibmean$silh)
normreport[3,3]=mean(neibmean$score)
normreport[3,4]=mean(neibmean$rscore)
normreport[3,5]=sum(metvarmean$metvar$padj<0.01)
normreport[3,6]=neibmean$sdist
normreport[3,7]=neibmean$ddist
normreport[4,2]=mean(neibsum$silh)
normreport[4,3]=mean(neibsum$score)
normreport[4,4]=mean(neibsum$rscore)
normreport[4,5]=sum(metvarsum$metvar$padj<0.01)
normreport[4,6]=neibsum$sdist
normreport[4,7]=neibsum$ddist
normreport[5,2]=mean(neibccmn$silh)
normreport[5,3]=mean(neibccmn$score)
normreport[5,4]=mean(neibccmn$rscore)
normreport[5,5]=sum(metvarccmn$metvar$padj<0.01)
normreport[5,6]=neibccmn$sdist
normreport[5,7]=neibccmn$ddist
normreport[6,2]=mean(neibnomis$silh)
normreport[6,3]=mean(neibnomis$score)
normreport[6,4]=mean(neibnomis$rscore)
normreport[6,5]=sum(metvarnomis$metvar$padj<0.01)
normreport[6,6]=neibnomis$sdist
normreport[6,7]=neibnomis$ddist
normreport[7,2]=mean(neibis$silh)
normreport[7,3]=mean(neibis$score)
normreport[7,4]=mean(neibis$rscore)
normreport[7,5]=sum(metvaris$metvar$padj<0.01)
normreport[7,6]=neibis$sdist
normreport[7,7]=neibis$ddist
normreport[8,2]=mean(neibccmn2$silh)
normreport[8,3]=mean(neibccmn2$score)
normreport[8,4]=mean(neibccmn2$rscore)
normreport[8,5]=sum(metvarccmn2$metvar$padj<0.01)
normreport[8,6]=neibccmn2$sdist
normreport[8,7]=neibccmn2$ddist
norm_ccmn <- Normalise(log.data,method="ccmn",nc=ncset)$output
metvarccmn=metvar(norm_ccmn[,2:91],log.data[,1])
neibccmn=neibcheck(norm_ccmn[,2:91])
norm_ccmn2 <- Normalise(log.data,method="ccmn",nc=ncset2)$output
metvarccmn2=metvar(norm_ccmn2[,2:87],log.data[,1])
neibccmn2=neibcheck(norm_ccmn2[,2:87])
normmethod=c("pre","median","mean","sum","ccmn","nomis","is","ccmn2")
normreport=data.frame(method=normmethod, silh=rep(0,8), score=rep(0,8), rscore=rep(0,8),difmet=rep(0,8),sd=rep(0,8),dd=rep(0,8), stringsAsFactors = F)
normreport[1,2]=mean(neibprenorm$silh)
normreport[1,3]=mean(neibprenorm$score)
normreport[1,4]=mean(neibprenorm$rscore)
normreport[1,5]=sum(metvarprenorm$metvar$padj<0.01)
normreport[1,6]=neibprenorm$sdist
normreport[1,7]=neibprenorm$ddist
normreport[2,2]=mean(neibmed$silh)
normreport[2,3]=mean(neibmed$score)
normreport[2,4]=mean(neibmed$rscore)
normreport[2,5]=sum(metvarmed$metvar$padj<0.01)
normreport[2,6]=neibmed$sdist
normreport[2,7]=neibmed$ddist
normreport[3,2]=mean(neibmean$silh)
normreport[3,3]=mean(neibmean$score)
normreport[3,4]=mean(neibmean$rscore)
normreport[3,5]=sum(metvarmean$metvar$padj<0.01)
normreport[3,6]=neibmean$sdist
normreport[3,7]=neibmean$ddist
normreport[4,2]=mean(neibsum$silh)
normreport[4,3]=mean(neibsum$score)
normreport[4,4]=mean(neibsum$rscore)
normreport[4,5]=sum(metvarsum$metvar$padj<0.01)
normreport[4,6]=neibsum$sdist
normreport[4,7]=neibsum$ddist
normreport[5,2]=mean(neibccmn$silh)
normreport[5,3]=mean(neibccmn$score)
normreport[5,4]=mean(neibccmn$rscore)
normreport[5,5]=sum(metvarccmn$metvar$padj<0.01)
normreport[5,6]=neibccmn$sdist
normreport[5,7]=neibccmn$ddist
normreport[6,2]=mean(neibnomis$silh)
normreport[6,3]=mean(neibnomis$score)
normreport[6,4]=mean(neibnomis$rscore)
normreport[6,5]=sum(metvarnomis$metvar$padj<0.01)
normreport[6,6]=neibnomis$sdist
normreport[6,7]=neibnomis$ddist
normreport[7,2]=mean(neibis$silh)
normreport[7,3]=mean(neibis$score)
normreport[7,4]=mean(neibis$rscore)
normreport[7,5]=sum(metvaris$metvar$padj<0.01)
normreport[7,6]=neibis$sdist
normreport[7,7]=neibis$ddist
normreport[8,2]=mean(neibccmn2$silh)
normreport[8,3]=mean(neibccmn2$score)
normreport[8,4]=mean(neibccmn2$rscore)
normreport[8,5]=sum(metvarccmn2$metvar$padj<0.01)
normreport[8,6]=neibccmn2$sdist
normreport[8,7]=neibccmn2$ddist
normreport
View(norm_ccmn)
View(norm_ccmn)
ccmncor=cor(norm_ccmn[,2:91])
ccmncor=as.dist(1-cor(norm_ccmn[,2:91]))
ccmnlink=hclust(ccmncor,method="average")
plot(ccmnlink)
plot(ccmnlink,hang=-1)
plot(ccmnlink,hang=-1, horiz=T)
plot(as.dendrogram(ccmnlink),hang=-1, horiz=T)
plot(as.dendrogram(ccmnlink), horiz=T)
plot(as.dendrogram(ccmnlink, hang=0.2), horiz=T)
plot(ccmnlink, hang=-1)
